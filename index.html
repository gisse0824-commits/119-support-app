<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a1b26">
    
    <title>ë¹„í™”ì¬ë³´ ì¶œë™ ì§€ì› ì‹œìŠ¤í…œ</title>

    <style>
        body {
            margin: 0; padding: 0; background-color: #1a1b26;
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif; color: white;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
            touch-action: manipulation;
        }
        .header-badge {
            margin-top: 50px; background-color: rgba(255, 77, 77, 0.1);
            border: 1px solid rgba(255, 77, 77, 0.3); color: #ff6b6b;
            padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: bold;
        }
        .main-title { font-size: 32px; font-weight: 800; margin: 15px 0 25px 0; text-align: center; line-height: 1.2; }
        .highlight-red { color: #ff4d4d; }

        .search-container { position: relative; width: 90%; max-width: 500px; margin-bottom: 15px; }
        .search-input {
            width: 100%; padding: 16px 110px 16px 20px;
            background-color: #24283b; border: 2px solid #414868; border-radius: 50px;
            color: #fff; font-size: 16px; outline: none; box-sizing: border-box;
        }
        .search-input:focus { border-color: #ff4d4d; }
        
        .btn-group-search {
            position: absolute; right: 6px; top: 6px; bottom: 6px;
            display: flex; gap: 4px;
        }
        
        .icon-btn {
            background-color: #414868; color: white; border: none; border-radius: 40px;
            padding: 0 14px; cursor: pointer; font-size: 18px; display: flex; align-items: center;
        }
        /* [ìˆ˜ì •] ë§ˆì´í¬ ë²„íŠ¼ ë°°ê²½ìƒ‰ì„ íŒŒë€ìƒ‰(#007bff)ìœ¼ë¡œ ë³€ê²½ */
        .voice-btn { background-color: #007bff; }
        .voice-btn.recording { background-color: #ff4d4d; animation: pulse 1.5s infinite; }
        .search-btn { background-color: #007bff; font-weight: bold; font-size: 14px; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .example-area {
            width: 90%; max-width: 500px; display: flex; 
            justify-content: flex-start; gap: 8px; flex-wrap: nowrap;
            margin-bottom: 30px; overflow-x: auto; padding: 5px 0 15px 0;
            -webkit-overflow-scrolling: touch;
        }
        .example-area::-webkit-scrollbar { display: none; }

        .tag-btn {
            background-color: #24283b; color: #a9b1d6; border: 1px solid #414868; 
            border-radius: 20px; padding: 8px 16px; font-size: 13px; cursor: pointer;
            white-space: nowrap; flex-shrink: 0;
        }

        #result-area { width: 92%; max-width: 500px; padding-bottom: 50px; }
        .info-card {
            background-color: #24283b; border-radius: 16px; padding: 20px;
            margin-bottom: 15px; border: 1px solid #414868; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .building-name { font-size: 20px; font-weight: bold; color: #7aa2f7; margin-bottom: 5px; }
        .addr-box { font-size: 13px; color: #a9b1d6; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #414868; }
        .data-row { margin-bottom: 15px; }
        .data-label { display: inline-block; color: #ff9e64; font-size: 12px; font-weight: bold; margin-bottom: 4px; }
        
        .data-content {
            background-color: #16161e; padding: 12px; border-radius: 8px;
            font-size: 15px; line-height: 1.5; border-left: 4px solid #ff4d4d;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .btn-group { display: flex; gap: 5px; }
        .action-btn {
            padding: 6px 10px; border-radius: 6px; font-size: 13px; font-weight: bold; 
            text-decoration: none; border: none; cursor: pointer;
        }
        .call-btn { background-color: #4caf50; color: white; }
        .edit-btn { background-color: #414868; color: #bb9af7; border: 1px solid #bb9af7; }

        .history-list { margin: 0; padding-left: 20px; color: #a9b1d6; font-size: 13px; }

        .map-btn-group { display: flex; gap: 8px; margin-top: 5px; }
        .map-btn {
            flex: 1; text-align: center; padding: 10px 0; border-radius: 8px;
            text-decoration: none; font-size: 13px; font-weight: bold; color: white;
        }
        .tmap { background-color: #E6002D; } 
        .kakao { background-color: #FEE500; color: #191919; } 
        .naver { background-color: #03C75A; } 
    </style>
</head>
<body>

    <div class="header-badge">ì¸ì²œì†Œë°©ë³¸ë¶€</div>
    
    <div class="main-title">
        ë¹„í™”ì¬ë³´(ì˜¤ì¸)<br>
        <span class="highlight-red">ì¶œë™ ì§€ì› ì‹œìŠ¤í…œ</span>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="ê±´ë¬¼ëª… ë˜ëŠ” ì£¼ì†Œ ì…ë ¥" onkeyup="if(window.event.keyCode==13){searchBuilding()}">
        <div class="btn-group-search">
            <button id="voiceBtn" class="icon-btn voice-btn" onclick="startVoiceRecognition()">ğŸ™ï¸</button>
            <button class="icon-btn search-btn" onclick="searchBuilding()">ê²€ìƒ‰</button>
        </div>
    </div>

    <div id="historyArea" class="example-area"></div>

    <div id="result-area"></div>

    <script>
        const buildingData = [
            { name: "ë¯¸ì¶”í™€ ì•„íŒŒíŠ¸ 101ë™", newAddr: "ì¸ì²œ ë¯¸ì¶”í™€êµ¬ ì†Œë°©ë¡œ 123", oldAddr: "ê´€êµë™ 11-1", panelLoc: "1ì¸µ ê²½ë¹„ì‹¤ ë‚´ë¶€ ìš°ì¸¡ ë²½ë©´ (Pí˜•)", manager: "ë°•ê´€ë¦¬ 010-1234-5678", note: "ì§€í•˜ì£¼ì°¨ì¥ ìŠµê¸°ë¡œ ì¸í•œ ì¦ì€ ì˜¤ì‘ë™ ë°œìƒí•¨.", history: ["24.11.20 - ì§€í•˜1ì¸µ ìŠµê¸° ì˜¤ì‘ë™", "24.08.15 - ì„¸ëŒ€ ë‚´ ìŒì‹ë¬¼ ì—°ê¸°"] },
            { name: "ì¸ì²œíƒ€ì›Œ ìƒê°€", newAddr: "ì¸ì²œ ë¯¸ì¶”í™€êµ¬ ì¸í•˜ë¡œ 55", oldAddr: "ìš©í˜„ë™ 22-5", panelLoc: "ì§€í•˜ 2ì¸µ ë°©ì¬ì‹¤ (Rí˜• ìˆ˜ì‹ ê¸°)", manager: "ê¹€ì†Œì¥ 010-9876-5432", note: "ì•¼ê°„ ì •ë¬¸ ì ê¹€. ê±´ë¬¼ ë’¤í¸ ë³´ì•ˆì‹¤ í˜¸ì¶œ í•„ìˆ˜.", history: ["24.10.05 - ê³µì‚¬í˜„ì¥ ë¶„ì§„", "24.02.11 - 1ì¸µ ì‹ë‹¹ ê°ì§€ê¸° ì˜¤ì‘ë™"] },
            { name: "ì¸ì²œ ì¤‘ì•™ì‹œì¥ (Aë™)", newAddr: "ì¸ì²œ ë¯¸ì¶”í™€êµ¬ ì‹œì¥ê¸¸ 12", oldAddr: "ìˆ­ì˜ë™ 200-1", panelLoc: "Aë™ ì…êµ¬ ë³´ì•ˆìš”ì› ëŒ€ê¸°ì‹¤ ë‚´ë¶€ (Pí˜•)", manager: "ì‹œì¥ì¡°í•© 032-123-4567", note: "ìƒˆë²½ ì‹œê°„ëŒ€ ë°˜ì°¬ê°€ê²Œ ìš”ë¦¬ ì—°ê¸°ë¡œ ì¸í•œ ì˜¤ì¸ ì‹ ê³  ì¦ìŒ.", history: ["25.12.10 - 1ì¸µ ìƒì„ ê°€ê²Œ ìŠ¤íŒ€ê¸° ì˜¤ì‘ë™", "25.09.01 - ì‹œì¥ ë‚´ ë¶„ì§„ ì‘ì—…"] },
            { name: "í–‰ë³µ ìš”ì–‘ë³‘ì›", newAddr: "ì¸ì²œ ë¯¸ì¶”í™€êµ¬ ì£¼ì•ˆë¡œ 99", oldAddr: "ì£¼ì•ˆë™ 77-7", panelLoc: "ë³¸ê´€ 1ì¸µ ì•ˆë‚´ë°ìŠ¤í¬ ë’¤ìª½ (Rí˜•)", manager: "í–‰ë³µë³‘ì› 032-999-8888", note: "í™˜ì ê±°ë™ ë¶ˆí¸ìœ¼ë¡œ í”¼ë‚œ ë³´ì¡° ì¸ë ¥ ë‹¤ìˆ˜ í•„ìš”. ì•¼ê°„ ê·¼ë¬´ì 3ëª….", history: ["25.12.20 - 3ì¸µ ë³‘ì‹¤ ê°€ìŠµê¸° ì˜¤ì‘ë™", "25.06.10 - ì£¼ë°© ì¡°ë¦¬ ì—°ê¸° ì˜¤ì¸"] }
        ];

        let searchHistory = JSON.parse(localStorage.getItem('fire_search_history')) || ["ë¯¸ì¶”í™€ ì•„íŒŒíŠ¸", "ì¸ì²œ ì¤‘ì•™ì‹œì¥", "ì¸ì²œíƒ€ì›Œ", "í–‰ë³µ ìš”ì–‘ë³‘ì›"];

        function renderHistory() {
            const area = document.getElementById('historyArea');
            area.innerHTML = searchHistory.map(keyword => 
                `<button class="tag-btn" onclick="setSearch('${keyword}')">#${keyword}</button>`
            ).join('');
        }

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'ko-KR';
            recognition.interimResults = false;

            recognition.onstart = () => { document.getElementById('voiceBtn').classList.add('recording'); };
            recognition.onend = () => { document.getElementById('voiceBtn').classList.remove('recording'); };
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('searchInput').value = transcript;
                searchBuilding();
            };
        }

        function startVoiceRecognition() {
            if (!recognition) { alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í¬ë¡¬ ì•±ì„ ì‚¬ìš©í•´ ì£¼ì„¸ìš”."); return; }
            recognition.start();
        }

        function setSearch(keyword) {
            document.getElementById('searchInput').value = keyword;
            searchBuilding();
        }

        function updateHistory(keyword) {
            searchHistory = [keyword, ...searchHistory.filter(item => item !== keyword)];
            searchHistory = searchHistory.slice(0, 4);
            localStorage.setItem('fire_search_history', JSON.stringify(searchHistory));
            renderHistory();
        }

        function requestFieldEdit(buildingName, fieldLabel, currentValue) {
            const newValue = prompt(`[${buildingName}] ${fieldLabel} ì •ë³´ ìˆ˜ì •\n\ní˜„ì¬ ë‚´ìš©: ${currentValue}\nìˆ˜ì •í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:`);
            if (newValue && newValue !== currentValue) {
                alert(`'${fieldLabel}' ìˆ˜ì • ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.\nê²€í†  í›„ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.`);
            }
        }

        function searchBuilding() {
            const input = document.getElementById('searchInput').value.trim();
            const resultArea = document.getElementById('result-area');
            if(input === "") { alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            resultArea.innerHTML = "";
            const normalizedInput = input.replace(/\s+/g, ""); 
            
            const results = buildingData.filter(item => {
                const nName = item.name.replace(/\s+/g, "");
                const nNew = item.newAddr.replace(/\s+/g, "");
                const nOld = item.oldAddr.replace(/\s+/g, "");
                return nName.includes(normalizedInput) || nNew.includes(normalizedInput) || nOld.includes(normalizedInput);
            });

            if(results.length > 0) {
                const displayName = results[0].name.split(' ')[0] + " " + (results[0].name.split(' ')[1] || "");
                updateHistory(displayName);
            }

            if(results.length === 0) {
                resultArea.innerHTML = "<div style='text-align:center; color:#565f89; margin-top:20px;'>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
                return;
            }

            results.forEach(item => {
                const phoneNum = item.manager.replace(/[^0-9]/g, '');
                const historyList = item.history.map(log => `<li>${log}</li>`).join('');
                resultArea.innerHTML += `
                    <div class="info-card">
                        <div class="building-name">${item.name}</div>
                        <div class="addr-box">${item.newAddr}</div>
                        <div class="data-row">
                            <span class="data-label">ğŸš¨ ìˆ˜ì‹ ë°˜(ìˆ˜ì‹ ê¸°) ìœ„ì¹˜</span>
                            <div class="data-content" style="font-weight:bold;">
                                <span>${item.panelLoc}</span>
                                <button class="action-btn edit-btn" onclick="requestFieldEdit('${item.name}', 'ìˆ˜ì‹ ê¸° ìœ„ì¹˜', '${item.panelLoc}')">ìˆ˜ì •</button>
                            </div>
                        </div>
                        <div class="data-row">
                            <span class="data-label">ğŸ“ ê´€ê³„ì¸ ì—°ë½ì²˜</span>
                            <div class="data-content">
                                <span>${item.manager}</span>
                                <div class="btn-group">
                                    <a href="tel:${phoneNum}" class="action-btn call-btn">í†µí™”</a>
                                    <button class="action-btn edit-btn" onclick="requestFieldEdit('${item.name}', 'ì—°ë½ì²˜', '${item.manager}')">ìˆ˜ì •</button>
                                </div>
                            </div>
                        </div>
                        <div class="data-row">
                            <span class="data-label">ğŸ“ ì£¼ìš” íŠ¹ì´ì‚¬í•­</span>
                            <div class="data-content" style="border-left-color:#7aa2f7; color:#c0caf5;">
                                <span>${item.note}</span>
                                <button class="action-btn edit-btn" onclick="requestFieldEdit('${item.name}', 'íŠ¹ì´ì‚¬í•­', '${item.note}')">ìˆ˜ì •</button>
                            </div>
                        </div>
                        <div class="data-row">
                            <span class="data-label">ğŸ•’ ê³¼ê±° ì¶œë™ ì´ë ¥</span>
                            <div class="data-content" style="border-left-color:#bb9af7;">
                                <ul class="history-list">${historyList}</ul>
                            </div>
                        </div>
                        <div class="data-row" style="margin-top:25px; padding-top:15px; border-top:1px dashed #414868;">
                            <span class="data-label">ğŸ—ºï¸ ê¸¸ì•ˆë‚´ (ë‚´ë¹„ê²Œì´ì…˜)</span>
                            <div class="map-btn-group">
                                <a href="tmap://search?name=${item.newAddr}" class="map-btn tmap">T map</a>
                                <a href="kakaomap://search?q=${item.newAddr}" class="map-btn kakao">ì¹´ì¹´ì˜¤ë§µ</a>
                                <a href="nmap://search?query=${item.newAddr}" class="map-btn naver">ë„¤ì´ë²„</a>
                            </div>
                        </div>
                    </div>`;
            });
        }

        renderHistory();
    </script>
</body>
</html>
